<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <div id="sunburst"></div>

    <!-- Load D3 -->
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

    <style>
      #sunburst { width: 1500px; margin: 12px 0; }
      .label { font: 12px sans-serif; pointer-events: none; text-anchor: middle; }
      .tooltip {
	  position: absolute; padding: 6px 8px; background: rgba(0,0,0,0.75); color: #fff;
	  border-radius: 4px; font: 12px sans-serif; pointer-events: none; opacity: 0;
      }
    </style>

    <div class="tooltip" id="tip"></div>

    <script>

      // -------- data (two-layer hierarchy) ----------
      const data = {name: "Camelot Wheel", children: [{name: "1A - Ab Minor", children: [{name: "1B - B Major", value: 1}]}, {name: "2A - Eb Minor", children: [{name: "2B - F# Major", value: 1}]}, {name: "3A - Bb Minor", children: [{name: "3B - Db Major", value: 1}]}, {name: "4A - F Minor", children: [{name: "4B - Ab Major", value: 1}]}, {name: "5A - C Minor", children: [{name: "5B - Eb Major", value: 1}]}, {name: "6A - G Minor", children: [{name: "6B - Bb Major", value: 1}]}, {name: "7A - D Minor", children: [{name: "7B - F Major", value: 1}]}, {name: "8A - A Minor", children: [{name: "8B - C Major", value: 1}]}, {name: "9A - E Minor", children: [{name: "9B - G Major", value: 1}]}, {name: "10A - B Minor", children: [{name: "10B - D Major", value: 1}]}, {name: "11A - F# Minor", children: [{name: "11B - A Major", value: 1}]}, {name: "12A - Db Minor", children: [{name: "12B - E Major", value: 1}]}]};

      // -------- sizing & SVG ----------
      const width = 800, height = 800, radius = Math.min(width, height) / 2;
      const svg = d3.select("#sunburst")
	    .append("svg")
	    .attr("viewBox", [-width/2, -height/2, width, height])
	    .attr("width", width)
	    .attr("height", height);
      
      // -------- layout ----------
      const root = d3.hierarchy(data)
	    .sum(d => d.value || 0)
	    .sort((a, b) => b.value - a.value);
      
      // Partition produces [x0,x1] angles and [y0,y1] radii for each node
      d3.partition().size([2 * Math.PI, radius])(root);
      
      // -------- arcs & color ----------
      const arc = d3.arc()
	    .startAngle(d => d.x0)
	    .endAngle(d => d.x1)
	    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))
	    .padRadius(radius * 0.8)
	    .innerRadius(d => d.y0)
	    .outerRadius(d => d.y1 - 1);
      
      const color = d3.scaleOrdinal()
	    .domain(root.children ? root.children.map(d => d.data.name) : [])
	    .range(d3.schemePaired);
      
      // Draw only non-root nodes (depth > 0), giving two visible rings for depth 1 and 2
      const nodes = root.descendants().filter(d => d.depth > 0);
      
      // Tooltip
      const tip = d3.select("#tip");
      
      // arcs
      svg.append("g")
    .selectAll("path")
    .data(nodes)
    .join("path")
    .attr("d", arc)
    .attr("fill", d => (d.depth === 1 ? color(d.data.name) : color(d.parent.data.name)))
    .attr("stroke", "#fff")
    .on("mousemove", (event, d) => {
	const total = root.value || 1;
	const pct = ((d.value / total) * 100).toFixed(1);
	tip
            .style("left", (event.clientX + 12) + "px")
            .style("top", (event.clientY + 12) + "px")
            .style("opacity", 1)
            .html(`<b>${d.ancestors().reverse().map(n => n.data.name).join(" → ")}</b><br>
               value: ${d.value}<br>
               share: ${pct}%`);
    })
    .on("mouseleave", () => tip.style("opacity", 0));

      // labels for outer ring (depth 2) and inner ring (depth 1) if there’s room
    const label = svg.append("g")
	  .attr("pointer-events", "none")
	  .attr("text-anchor", "middle")
	  .selectAll("text")
	  .data(nodes)
	  .join("text")
	  .attr("class", "label")
	  .attr("transform", d => {
	      const x = (d.x0 + d.x1) / 2;
	      const y = (d.y0 + d.y1) / 2;
	      const angle = (x * 180 / Math.PI) - 90;
	      return `rotate(${angle}) translate(${y},0) rotate(${angle < 90 || angle >= 270 ? 0 : 180})`;
	  })
	  .attr("dy", "0.35em")
	  .text(d => d.data.name)
	  .style("display", d => ((d.x1 - d.x0) > 0.06 ? null : "none")); // hide cramped labels
    </script>

  </body>
</html>

